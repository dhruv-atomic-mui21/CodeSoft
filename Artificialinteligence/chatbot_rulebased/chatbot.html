<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CUDA - Personal Chat Assistant</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #f8fafc;
            --accent: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            pointer-events: none;
        }
        
        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 800px;
            height: 80vh;
            max-height: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        
        .chat-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
            overflow: hidden;
        }
        
        .chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .cuda-logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #00d4ff, #5b73f0);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }
        
        .header-info {
            flex: 1;
            position: relative;
            z-index: 1;
        }
        
        .header-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .header-status {
            font-size: 14px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .chat-stats {
            display: flex;
            gap: 16px;
            font-size: 12px;
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: var(--bg-secondary);
            position: relative;
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 3px;
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            animation: slideUp 0.4s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message.user {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .message.bot .message-avatar {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--accent), #059669);
            color: white;
        }
        
        .message-content {
            max-width: 65%;
            position: relative;
        }
        
        .message-bubble {
            padding: 16px 20px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.5;
            position: relative;
            box-shadow: var(--shadow);
        }
        
        .message.bot .message-bubble {
            background: var(--bg-primary);
            color: var(--text-primary);
            border-bottom-left-radius: 6px;
            border: 1px solid var(--border);
        }
        
        .message.user .message-bubble {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-bottom-right-radius: 6px;
        }
        
        .message-time {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 4px;
            text-align: right;
        }
        
        .message.bot .message-time {
            text-align: left;
        }
        
        .typing-indicator {
            display: none;
            margin-bottom: 20px;
            animation: slideUp 0.4s ease-out;
        }
        
        .typing-bubble {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            padding: 16px 20px;
            max-width: 80px;
            box-shadow: var(--shadow);
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-12px);
                opacity: 1;
            }
        }
        
        .chat-input-container {
            padding: 20px 24px;
            background: var(--bg-primary);
            border-top: 1px solid var(--border);
            position: relative;
        }
        
        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            position: relative;
        }
        
        .chat-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--border);
            border-radius: 24px;
            font-size: 16px;
            font-family: inherit;
            outline: none;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
            resize: none;
            min-height: 56px;
            max-height: 120px;
        }
        
        .chat-input:focus {
            border-color: var(--primary);
            background: var(--bg-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .input-actions {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }
        
        .action-button {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .clear-button {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }
        
        .clear-button:hover {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }
        
        .suggestions {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .suggestion-chip {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .suggestion-chip:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-1px);
        }
        
        .feature-highlight {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: 12px;
            padding: 12px;
            margin: 8px 0;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .math-result {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--primary);
        }
        
        .response-time {
            font-size: 10px;
            color: var(--text-secondary);
            opacity: 0.7;
            margin-left: 8px;
        }
        
        .error-message {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            color: var(--error);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .chat-container {
                height: 90vh;
                border-radius: 16px;
            }
            
            .chat-header {
                padding: 16px 20px;
            }
            
            .header-title {
                font-size: 20px;
            }
            
            .chat-messages {
                padding: 16px;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .chat-stats {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="cuda-logo">C</div>
            <div class="header-info">
                <div class="header-title">CUDA</div>
                <div class="header-status">
                    <div class="status-dot"></div>
                    Rule-Based Chat Assistant
                </div>
            </div>
            <div class="chat-stats">
                <div class="stat-item">
                    <span id="messageCount">0</span>
                    <span>Messages</span>
                </div>
                <div class="stat-item">
                    <span id="sessionTime">00:00</span>
                    <span>Session</span>
                </div>
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="message-avatar">C</div>
                <div class="message-content">
                    <div class="message-bubble">
                        👋 Hello! I'm <strong>CUDA</strong>, your rule-based chat assistant. I can help you with:
                        <div class="feature-highlight">
                            🧮 Math calculations • 🌍 General questions • 💭 Creative tasks • 🎯 Problem solving • 📝 Information lookup
                        </div>
                        What would you like to explore today?
                    </div>
                    <div class="message-time" id="welcomeTime"></div>
                </div>
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <div class="message bot">
                <div class="message-avatar">C</div>
                <div class="message-content">
                    <div class="typing-bubble">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <div class="suggestions" id="suggestions">
                <div class="suggestion-chip" data-text="What can you do?">💡 Capabilities</div>
                <div class="suggestion-chip" data-text="Calculate 25 * 47 + 180">🧮 Math</div>
                <div class="suggestion-chip" data-text="Tell me about AI">🤖 AI Facts</div>
                <div class="suggestion-chip" data-text="My name is Alex">👤 Introduce</div>
            </div>
            <div class="input-wrapper">
                <textarea 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Type your message to CUDA..." 
                    rows="1"
                    maxlength="1000"
                    aria-label="Chat input">
                </textarea>
                <div class="input-actions">
                    <button class="action-button clear-button" id="clearButton" title="Clear chat" aria-label="Clear chat">🗑️</button>
                    <button class="action-button send-button" id="sendButton" title="Send message" aria-label="Send message" disabled>🚀</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Constants
        const CONFIG = {
            TYPING_DELAY: { MIN: 500, MAX: 1500 },
            MAX_MESSAGE_LENGTH: 1000,
            MATH_DECIMAL_PLACES: 6,
            ANIMATION_DURATION: 400
        };

        // Utility functions
        const utils = {
            sanitizeInput: (input) => input.trim().replace(/[<>]/g, ''),
            
            formatTime: (date = new Date()) => 
                date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
            
            formatDate: (date = new Date()) => 
                date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }),
            
            formatNumber: (num) => {
                if (typeof num !== 'number' || !isFinite(num)) return 'Invalid';
                return num % 1 === 0 ? 
                    num.toString() : 
                    num.toFixed(CONFIG.MATH_DECIMAL_PLACES).replace(/\.?0+$/, '');
            },
            
            escapeHtml: (text) => 
                text.replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#x27;'),
            
            debounce: (func, delay) => {
                let timeout;
                return (...args) => {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(null, args), delay);
                };
            }
        };

        // Math expression evaluator with security
        const mathEvaluator = {
            safeOperators: /^[\d\+\-\*\/\(\)\s\.\^\%]+$/,
            
            evaluate: (expression) => {
                try {
                    const cleaned = expression.replace(/\s+/g, '');
                    if (!mathEvaluator.safeOperators.test(cleaned)) {
                        throw new Error('Invalid characters in expression');
                    }
                    const normalized = cleaned.replace(/\^/g, '**');
                    if (/(function|eval|constructor|prototype|__)/i.test(normalized)) {
                        throw new Error('Potentially dangerous expression');
                    }
                    const result = Function(`"use strict"; return (${normalized})`)();
                    if (typeof result !== 'number' || !isFinite(result)) {
                        throw new Error('Invalid result');
                    }
                    return result;
                } catch (error) {
                    throw new Error(`Math error: ${error.message}`);
                }
            }
        };

        // Rule-based chatbot class
        class RuleBasedChatbot {
            constructor() {
                this.userData = {
                    name: null,
                    preferences: {},
                    conversationHistory: []
                };
                this.rules = this.initializeRules();
            }

            initializeRules() {
                return [
                    {
                        id: 'greeting',
                        patterns: [
                            /^(hi|hello|hey|greetings|good\s+(morning|afternoon|evening|night))$/i,
                            /^(what's\s+up|how's\s+it\s+going|howdy)$/i
                        ],
                        response: () => this.getGreetingResponse()
                    },
                    {
                        id: 'name_introduction',
                        patterns: [
                            /(?:my\s+name\s+is|i'm|call\s+me|i\s+am)\s+(\w+)/i,
                            /(\w+)\s+is\s+my\s+name/i
                        ],
                        response: (input) => this.handleNameIntroduction(input)
                    },
                    {
                        id: 'capabilities',
                        patterns: [
                            /what\s+can\s+you\s+do/i,
                            /(?:your\s+)?capabilities/i,
                            /help\s+me\s+understand/i,
                            /what\s+are\s+you\s+capable\s+of/i
                        ],
                        response: () => this.getCapabilitiesResponse()
                    },
                    {
                        id: 'math_calculation',
                        patterns: [
                            /(?:calculate|compute|solve|math|what\s+is)\s*(.+)/i,
                            /(\d+[\+\-\*\/\^\%\(\)]+[\d\+\-\*\/\^\%\(\)\s]*)/
                        ],
                        response: (input) => this.handleMathCalculation(input)
                    },
                    {
                        id: 'tech_queries',
                        patterns: [
                            /artificial\s+intelligence|machine\s+learning|AI(?:\s|$)/i,
                            /(?:computer\s+)?technology/i,
                            /(?:computer\s+)?science/i,
                            /quantum(?:\s+computing)?/i,
                            /programming|coding|software/i
                        ],
                        response: (input) => this.handleTechQuery(input)
                    },
                    {
                        id: 'creative_tasks',
                        patterns: [
                            /(?:write|create|generate)\s+(?:a\s+)?(story|poem|idea)/i,
                            /brainstorm|creative|imagination/i,
                            /help\s+me\s+(?:write|create)/i
                        ],
                        response: (input) => this.handleCreativeTask(input)
                    },
                    {
                        id: 'time_date',
                        patterns: [
                            /what\s+time|current\s+time|time\s+is\s+it/i,
                            /what.*date|today.*date|current.*date/i,
                            /(?:what\s+day|today)\s+is\s+it/i
                        ],
                        response: () => this.getTimeResponse()
                    },
                    {
                        id: 'weather',
                        patterns: [
                            /weather|temperature|forecast|climate/i,
                            /(?:is\s+it\s+)?(?:raining|sunny|cloudy)/i
                        ],
                        response: () => this.getWeatherResponse()
                    },
                    {
                        id: 'how_are_you',
                        patterns: [
                            /how\s+are\s+you/i,
                            /how\s+do\s+you\s+feel/i,
                            /your\s+mood|are\s+you\s+okay/i
                        ],
                        response: () => this.getStatusResponse()
                    },
                    {
                        id: 'thanks',
                        patterns: [
                            /thank\s+you|thanks|appreciate|grateful/i,
                            /that's\s+helpful|very\s+helpful/i
                        ],
                        response: () => this.getThanksResponse()
                    },
                    {
                        id: 'farewell',
                        patterns: [
                            /^(bye|goodbye|see\s+you|farewell|exit|quit)$/i,
                            /^(take\s+care|until\s+next\s+time)$/i
                        ],
                        response: () => this.getFarewellResponse()
                    }
                ];
            }

            processInput(input) {
                const sanitized = utils.sanitizeInput(input);
                this.userData.conversationHistory.push({
                    type: 'user',
                    message: sanitized,
                    timestamp: new Date()
                });

                for (const rule of this.rules) {
                    for (const pattern of rule.patterns) {
                        const match = sanitized.match(pattern);
                        if (match) {
                            const response = rule.response(sanitized, match);
                            this.userData.conversationHistory.push({
                                type: 'bot',
                                message: response,
                                timestamp: new Date()
                            });
                            return response;
                        }
                    }
                }
                return this.getFallbackResponse(sanitized);
            }

            getGreetingResponse() {
                const greetings = [
                    "Hello! I'm CUDA, your rule-based chatbot. How can I assist you today?",
                    "Hi there! Ready to help with whatever you need.",
                    "Greetings! What would you like to explore together?"
                ];
                return this.userData.name ? 
                    `Hello, ${this.userData.name}! How can I help you today?` :
                    greetings[Math.floor(Math.random() * greetings.length)];
            }

            handleNameIntroduction(input) {
                const matches = input.match(/(?:my\s+name\s+is|i'm|call\s+me|i\s+am)\s+(\w+)/i) ||
                               input.match(/(\w+)\s+is\s+my\s+name/i);
                if (matches) {
                    this.userData.name = matches[1];
                    return `Nice to meet you, ${this.userData.name}! I'll remember your name. How can I help you today?`;
                }
                return "I'd love to know your name! You can say 'My name is [name]' or 'I'm [name]'.";
            }

            getCapabilitiesResponse() {
                return `I'm a rule-based chatbot with these capabilities:
                <div class="feature-highlight">
                    🧮 <strong>Math:</strong> I can solve calculations and equations<br>
                    🌍 <strong>Information:</strong> Answer questions about various topics<br>
                    💭 <strong>Creative:</strong> Help with writing and brainstorming<br>
                    🕒 <strong>Time:</strong> Provide current date and time<br>
                    🎯 <strong>General:</strong> Chat about technology, science, and more
                </div>
                Try asking me something!`;
            }

            handleMathCalculation(input) {
                try {
                    const mathMatch = input.match(/[\d\+\-\*\/\^\%\(\)\s\.]+/);
                    if (!mathMatch) {
                        return "Please provide a valid mathematical expression using numbers and operators (+, -, *, /, %, ^, parentheses).";
                    }
                    const expression = mathMatch[0].trim();
                    const result = mathEvaluator.evaluate(expression);
                    const formattedResult = utils.formatNumber(result);
                    return `<div class="math-result">
                        🧮 Expression: ${utils.escapeHtml(expression)}<br>
                        ✨ Result: <strong>${formattedResult}</strong>
                    </div>
                    ${result > 1000000 ? 'That\'s quite a large number! ' : ''}Need help with more calculations?`;
                } catch (error) {
                    return `<div class="error-message">
                        ❌ ${error.message}<br>
                        Please check your math expression and try again.
                    </div>`;
                }
            }

            handleTechQuery(input) {
                const topic = input.toLowerCase();
                const responses = {
                    'artificial intelligence': "Artificial Intelligence (AI) is fascinating! It's the simulation of human intelligence in machines. AI includes machine learning, natural language processing, computer vision, and robotics. What specific aspect of AI interests you?",
                    'machine learning': "Machine Learning is a subset of AI that enables computers to learn from data without being explicitly programmed. It includes supervised learning, unsupervised learning, and reinforcement learning. Would you like to know more about any of these?",
                    'technology': "Technology is constantly evolving, encompassing everything from computers and software to quantum computing and AI. What technology topic interests you?",
                    'programming': "Programming is the art of writing instructions for computers. There are many languages like JavaScript, Python, and C++. What programming language or concept would you like to discuss?",
                    'quantum computing': "Quantum computing uses quantum bits to perform complex calculations much faster than classical computers. It's an exciting and emerging field. Do you want to learn about quantum algorithms or hardware?",
                    'software': "Software development involves designing, coding, testing, and maintaining applications. Are you interested in web development, mobile apps, or something else?"
                };
                for (const key in responses) {
                    if (topic.includes(key)) {
                        return responses[key];
                    }
                }
                return "That's an interesting tech topic! Could you please specify your question or what you'd like to know more about?";
            }

            handleCreativeTask(input) {
                const creativePrompts = [
                    "Here's a short story idea: A time traveler stuck in the past tries to fix history without changing the future.",
                    "How about a poem? 'In the quiet night, stars whisper secrets of the light.'",
                    "Let's brainstorm ideas for a novel about a detective with supernatural powers.",
                    "I can help you generate creative writing prompts or ideas. What genre do you prefer?"
                ];
                return creativePrompts[Math.floor(Math.random() * creativePrompts.length)];
            }

            getTimeResponse() {
                const now = new Date();
                return `Current time is ${utils.formatTime(now)} on ${utils.formatDate(now)}.`;
            }

            getWeatherResponse() {
                return "I don't have real-time weather data, but you can check your local weather forecast online or use a weather app.";
            }

            getStatusResponse() {
                return "I'm just a program, but I'm here and ready to help you!";
            }

            getThanksResponse() {
                return "You're welcome! If you have more questions, feel free to ask.";
            }

            getFarewellResponse() {
                return "Goodbye! Have a great day. Feel free to come back anytime.";
            }

            getFallbackResponse(input) {
                return `I'm not sure how to respond to "${utils.escapeHtml(input)}". Could you please rephrase or ask something else?`;
            }
        }

        // UI and interaction logic
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const clearButton = document.getElementById('clearButton');
        const suggestions = document.getElementById('suggestions');
        const typingIndicator = document.getElementById('typingIndicator');
        const messageCountElem = document.getElementById('messageCount');
        const sessionTimeElem = document.getElementById('sessionTime');

        let chatbot = new RuleBasedChatbot();
        let messageCount = 1; // Starting with welcome message
        let sessionStartTime = new Date();
        let sessionTimerInterval;

        function updateSessionTime() {
            const now = new Date();
            const diff = new Date(now - sessionStartTime);
            const minutes = String(diff.getUTCMinutes()).padStart(2, '0');
            const seconds = String(diff.getUTCSeconds()).padStart(2, '0');
            sessionTimeElem.textContent = `${minutes}:${seconds}`;
        }

        function addMessage(content, sender = 'bot') {
            const messageElem = document.createElement('div');
            messageElem.classList.add('message', sender);
            const avatarElem = document.createElement('div');
            avatarElem.classList.add('message-avatar');
            avatarElem.textContent = sender === 'bot' ? 'C' : 'U';
            const contentElem = document.createElement('div');
            contentElem.classList.add('message-content');
            const bubbleElem = document.createElement('div');
            bubbleElem.classList.add('message-bubble');
            bubbleElem.innerHTML = content;
            const timeElem = document.createElement('div');
            timeElem.classList.add('message-time');
            timeElem.textContent = utils.formatTime();
            contentElem.appendChild(bubbleElem);
            contentElem.appendChild(timeElem);
            messageElem.appendChild(avatarElem);
            messageElem.appendChild(contentElem);
            chatMessages.appendChild(messageElem);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            messageCount++;
            messageCountElem.textContent = messageCount.toString();
        }

        function showTypingIndicator(show) {
            typingIndicator.style.display = show ? 'block' : 'none';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function handleUserInput() {
            const input = chatInput.value.trim();
            if (input.length === 0 || input.length > CONFIG.MAX_MESSAGE_LENGTH) {
                sendButton.disabled = true;
                return;
            }
            sendButton.disabled = false;
        }

        function sendMessage() {
            const input = chatInput.value.trim();
            if (input.length === 0) return;
            addMessage(utils.escapeHtml(input), 'user');
            chatInput.value = '';
            sendButton.disabled = true;
            showTypingIndicator(true);

            // Simulate typing delay
            const delay = Math.floor(Math.random() * (CONFIG.TYPING_DELAY.MAX - CONFIG.TYPING_DELAY.MIN + 1)) + CONFIG.TYPING_DELAY.MIN;
            setTimeout(() => {
                const response = chatbot.processInput(input);
                showTypingIndicator(false);
                addMessage(response, 'bot');
            }, delay);
        }

        function clearChat() {
            chatMessages.innerHTML = '';
            messageCount = 0;
            messageCountElem.textContent = '0';
            chatbot = new RuleBasedChatbot();
            addMessage(`👋 Hello! I'm <strong>CUDA</strong>, your rule-based chat assistant. I can help you with:
                <div class="feature-highlight">
                    🧮 Math calculations • 🌍 General questions • 💭 Creative tasks • 🎯 Problem solving • 📝 Information lookup
                </div>
                What would you like to explore today?`, 'bot');
            messageCount = 1;
            messageCountElem.textContent = '1';
            sessionStartTime = new Date();
            updateSessionTime();
        }

        function handleSuggestionClick(event) {
            if (event.target.classList.contains('suggestion-chip')) {
                const text = event.target.getAttribute('data-text');
                chatInput.value = text;
                chatInput.focus();
                handleUserInput();
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            clearChat();
            sessionTimerInterval = setInterval(updateSessionTime, 1000);
        });

        chatInput.addEventListener('input', utils.debounce(handleUserInput, 200));
        sendButton.addEventListener('click', sendMessage);
        clearButton.addEventListener('click', clearChat);
        suggestions.addEventListener('click', handleSuggestionClick);

        // Accessibility: send message on Enter key (Shift+Enter for newline)
        chatInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                if (!sendButton.disabled) {
                    sendMessage();
                }
            }
        });
    </script>
</body>
</html>
